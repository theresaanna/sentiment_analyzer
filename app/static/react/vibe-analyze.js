import{c as te,j as e,r as S,R as Oe}from"./chunks/client-DhEz86-d.js";function qe(j){try{return String(j).replace(/[&<>"']/g,M=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[M])}catch{return String(j)}}function ve(j,M){try{console.error("[Analyze Fatal]",j,M);const E=document.querySelector(".analyze-page .container")||document.body,J=document.createElement("div");J.className="vibe-card",J.style.marginTop="20px";const ie=M?qe(M.stack||M.message||String(M)):"";J.innerHTML=`
      <div class="card-header-vibe">
        <h3 class="mb-0"><span class="emoji-icon">⚠️</span> Analyze UI Error</h3>
      </div>
      <div class="card-body">
        <div class="alert alert-danger"><strong>${qe(j)}</strong></div>
        ${ie?`<pre style="white-space:pre-wrap; background:#f8f9fa; padding:12px; border-radius:8px;">${ie}</pre>`:""}
      </div>
    `,E.insertBefore(J,E.firstChild)}catch(E){console.error("Failed to render fatal error box",E)}}typeof window<"u"&&(window.__ANALYZE_ERROR_GUARDS__||(window.__ANALYZE_ERROR_GUARDS__=!0,window.addEventListener("error",j=>{try{ve("A runtime error occurred on the Analyze page.",(j==null?void 0:j.error)||(j==null?void 0:j.message))}catch{}}),window.addEventListener("unhandledrejection",j=>{try{ve("An async error occurred on the Analyze page.",j==null?void 0:j.reason)}catch{}})));function nt(){return S.useEffect(()=>{try{let j=function(){const t=document.getElementById("sentimentAnalysisSection");t&&(t.style.display="block",setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})},100),setTimeout(()=>{E()},500))},M=function(t,a){if(le=t,t!=="queue"){const i=document.getElementById("sentimentAnalysisSection"),n=document.getElementById("analysisProgress"),s=document.getElementById("analysisResults");i&&(i.style.display="block",i.classList.add("active")),n&&(n.style.display="flex"),s&&(s.style.display="none"),ce=Date.now(),J(B,a,Math.round(a/(window.currentTotalComments||5e3)*100))}},E=function(){const t=document.getElementById("instantSlider"),a=parseInt(t&&t.value||"100",10);le="instant",O&&clearInterval(O),q&&clearInterval(q),V&&cancelAnimationFrame(V),Te=0,de=0,se=0,Xe=0;const i=document.getElementById("sentimentAnalysisSection"),n=document.getElementById("analysisProgress"),s=document.getElementById("analysisResults"),r=document.getElementById("analysisActionButton"),o=Number((A==null?void 0:A.total_available)||0),c=Number((A==null?void 0:A.total_comments)||0),m=o||Ze||c||0;let l=Math.min(a,oe?re?5e3:2500:500);l=Math.max(l,5),i&&(i.style.display="block",i.classList.add("active")),n&&(n.style.display="flex"),s&&(s.style.display="none");const x=document.getElementById("funFactText");x&&(x.textContent=ne[0]),r&&(r.disabled=!0,r.innerHTML='<i class="fas fa-spinner fa-spin"></i> Analyzing...'),i==null||i.scrollIntoView({behavior:"smooth",block:"start"});const v=Math.round(l/(window.currentTotalComments||5e3)*100);ce=Date.now(),J(B,l,v)},J=function(t,a,i){fetch(`/api/analyze/sentiment/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({max_comments:a,percentage_selected:i,include_replies:!1})}).then(s=>s.status===507?(H("The analysis cache is currently full. Please wait a moment while we clear some space and try again."),setTimeout(()=>{H("Retrying analysis..."),E()},3e3),null):s.json()).then(s=>{s&&(s.success?(R=s.analysis_id,window.currentAnalysisId=R,s.cached?be():Y=setInterval(ie,1e3)):H(s.error||"Failed to start analysis"))}).catch(s=>H("Failed to start analysis: "+s))},ie=function(){R&&fetch(`/api/analyze/status/${R}`).then(t=>t.json()).then(t=>{t.success?(Ue(t.status),t.status.status==="completed"?(clearInterval(Y),be()):t.status.status==="error"&&(clearInterval(Y),H(t.status.error))):!t.success&&t.error==="Analysis not found"&&(clearInterval(Y),H("Analysis data was cleared. Restarting..."),R=null,setTimeout(()=>E(),1500))}).catch(t=>console.error("Status check error:",t))},be=function(){R&&fetch(`/api/analyze/results/${R}`).then(t=>t.json()).then(t=>{var a,i;t.success?(window.dispatchEvent(new CustomEvent("analysis:results",{detail:t.results})),(i=(a=t.results)==null?void 0:a.sentiment)!=null&&i.individual_results&&window.dispatchEvent(new CustomEvent("analysis:samples",{detail:t.results.sentiment.individual_results})),Ae(t.results)):t.restart_needed||t.error&&t.error.includes("Analysis not found")?(H("This analysis has expired or been cleared. Starting a new analysis..."),R=null,setTimeout(()=>{const n=document.getElementById("analysisProgress"),s=document.getElementById("analysisResults");n&&(n.style.display="flex"),s&&(s.style.display="none"),E()},1500)):H(t.error+(t.details?": "+t.details:""))}).catch(t=>H("Failed to fetch results: "+t))},Ue=function(t){de=t.progress||0;let a="Initializing vibe check...",i="",n=[];switch(t.status){case"fetching_comments":a="Downloading Comments",i=X.fetching_comments[0],n=X.fetching_comments;break;case"using_cached":a="Loading Cached Data",i="Retrieving pre-analyzed vibes...";break;case"analyzing_sentiment":a="Analyzing Sentiment",i=X.analyzing_sentiment[0],n=X.analyzing_sentiment;break;case"generating_summary":a="Generating Insights",i=X.generating_summary[0],n=X.generating_summary;break;case"completed":a="✨ Analysis Complete!",i="Your results are ready!";break}Te=de,window.dispatchEvent(new CustomEvent("analysis:progress",{detail:{progress:de,status:a,subStatus:i}})),n.length>0&&t.status!=="completed"&&(O&&clearInterval(O),se=0,O=setInterval(()=>{se=(se+1)%n.length,window.dispatchEvent(new CustomEvent("analysis:progress",{detail:{subStatus:n[se]}}))},3e3)),!q&&t.status!=="completed"&&(q=setInterval(()=>{window.dispatchEvent(new CustomEvent("analysis:progress",{detail:{}}))},5e3))},We=function(){if(!R)return;const t=document.getElementById("aiSummary");t&&(t.innerHTML='<p>Retrying summary... <i class="fas fa-spinner fa-spin"></i></p>'),fetch(`/api/analyze/retry-summary/${R}`,{method:"POST"}).then(a=>a.json()).then(a=>{a.success&&a.summary&&a.summary.summary&&be()}).catch(a=>{t&&(t.innerHTML=`<p>Summary retry failed: ${a}</p>`)})},Ae=function(t){const a=document.getElementById("analysisProgress"),i=document.getElementById("analysisResults"),n=document.getElementById("sampleCommentsSection"),s=document.getElementById("startSentimentAnalysis");if(!t||!t.sentiment){H("No results returned. Please try again.");return}a&&(a.style.display="none"),i&&(i.style.display="block"),n&&(n.style.display="block"),s&&(s.innerHTML='<i class="fas fa-sync"></i> Re-analyze',s.disabled=!1);const r=t.sentiment,o=document.getElementById("overallSentiment");let c="neutral",m=50;if(r.distribution){const u=r.distribution.positive||0,d=r.distribution.negative||0,g=r.distribution.neutral||0,h=u+d+g;h>0&&(m=(u-d)/h*50+50,u>d&&u>g?c="positive":d>u&&d>g?c="negative":c="neutral")}const l=typeof r.average_confidence=="number"?r.average_confidence:0,x=l>1?l.toFixed(1):(l*100).toFixed(1),v=r.total_analyzed||(Array.isArray(r.individual_results)?r.individual_results.length:0);o&&(o.innerHTML=`
          <strong>${c.charAt(0).toUpperCase()+c.slice(1)}</strong>
          (Score: ${m.toFixed(1)}%, Confidence: ${x}%)<br>
          <small>Analyzed ${v} comments using advanced sentiment analysis</small>
        `);const p=document.getElementById("aiSummary"),b=t.summary;if(p&&b)if(b.summary)p.innerHTML=`<p>${b.summary}</p>`;else{p.innerHTML='<p>Summary not available. <a href="#" id="retrySummaryLink">Try again</a></p>';const u=document.getElementById("retrySummaryLink");u&&u.addEventListener("click",d=>{d.preventDefault(),u.innerHTML='Retrying... <i class="fas fa-spinner fa-spin"></i>',We()})}if(setTimeout(()=>{var u;try{Ye(r)}catch(d){console.error("bar chart error",d)}try{let d=t.timeline;if((!d||d.length===0)&&r.individual_results&&r.individual_results.length>0&&(d=r.individual_results.map((g,h)=>({sentiment:g.predicted_sentiment||g.sentiment||"neutral",score:g.sentiment_scores||{positive:g.predicted_sentiment==="positive"?.8:.1,neutral:g.predicted_sentiment==="neutral"?.8:.1,negative:g.predicted_sentiment==="negative"?.8:.1},text_preview:(g.text||"").substring(0,100),index:h}))),d&&d.length>0)Je(d);else{const g=(u=document.querySelector("#sentimentTimelineChart"))==null?void 0:u.closest(".card");g&&(g.style.display="none")}}catch(d){console.error("timeline chart error",d)}},300),t.updated_stats){const u=ce?Math.max(1,Math.round((Date.now()-ce)/1e3)):null;Qe(t.updated_stats,{elapsedSeconds:u,totalAnalyzed:t.updated_stats.total_analyzed,videoViews:ye,videoLikes:Ie})}},Ye=function(t){const a=document.getElementById("sentimentPieChart");if(!a||!window.Chart)return;const i=a.getContext("2d");z.bar&&z.bar.destroy();const n=t.sentiment_counts||t.distribution||{positive:0,neutral:0,negative:0},s=n.positive+n.neutral+n.negative,r=s>0?{positive:(n.positive/s*100).toFixed(1),neutral:(n.neutral/s*100).toFixed(1),negative:(n.negative/s*100).toFixed(1)}:{positive:0,neutral:0,negative:0};z.bar=new window.Chart(i,{type:"bar",data:{labels:[""],datasets:[{label:`Positive (${r.positive}%)`,data:[n.positive||0],backgroundColor:"rgba(34,197,94,0.9)",borderColor:"rgba(34,197,94,1)",borderWidth:1},{label:`Neutral (${r.neutral}%)`,data:[n.neutral||0],backgroundColor:"rgba(156,163,175,0.9)",borderColor:"rgba(156,163,175,1)",borderWidth:1},{label:`Negative (${r.negative}%)`,data:[n.negative||0],backgroundColor:"rgba(239,68,68,0.9)",borderColor:"rgba(239,68,68,1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,display:!1,grid:{display:!1}},y:{stacked:!0,display:!1,grid:{display:!1}}},plugins:{legend:{display:!0,position:"bottom",labels:{boxWidth:15,padding:8,font:{size:11}}},tooltip:{callbacks:{label:o=>{const c=o.dataset.label||"";return`${o.parsed.x||0} comments`}}}}}})},Je=function(t){const a=document.getElementById("sentimentTimelineChart");if(!a||!window.Chart)return;const i=a.getContext("2d");if(z.timeline&&z.timeline.destroy(),!t||t.length===0){const l=a.closest(".card");if(l){const x=l.querySelector(".card-body");x&&(x.innerHTML='<p class="text-muted text-center py-3">Timeline data not available for this analysis</p>')}return}const n=[],s=Math.max(1,Math.ceil(t.length/20));for(let l=0;l<t.length;l+=s){const x=t.slice(l,Math.min(l+s,t.length));let v=0,p=0,b=0,u=0;x.forEach(g=>{let f=g.score||g.sentiment_scores||{};if(!f||Object.keys(f).length===0){const y=g.sentiment||g.predicted_sentiment||"neutral";f=y==="positive"?{positive:.8,neutral:.15,negative:.05}:y==="negative"?{positive:.05,neutral:.15,negative:.8}:{positive:.1,neutral:.8,negative:.1}}v+=f.positive||0,p+=f.neutral||0,b+=f.negative||0,u++});const d=Math.max(u,1);n.push({positive:v/d*100,neutral:p/d*100,negative:b/d*100,index:l})}const r=[],o=[],c=[],m=[];n.forEach((l,x)=>{const v=l.index/t.length*100;x===0?r.push("Early"):x===n.length-1?r.push("Recent"):Math.abs(v-25)<5?r.push("25%"):Math.abs(v-50)<5?r.push("Midpoint"):Math.abs(v-75)<5?r.push("75%"):r.push(`${Math.round(v)}%`),o.push(l.positive),c.push(l.neutral),m.push(l.negative)}),z.timeline=new window.Chart(i,{type:"line",data:{labels:r,datasets:[{label:"Positive",data:o,borderColor:"rgba(25,135,84,1)",backgroundColor:"rgba(209,231,221,0.35)",tension:.4},{label:"Neutral",data:c,borderColor:"rgba(160,165,170,1)",backgroundColor:"rgba(206,212,218,0.35)",tension:.4},{label:"Negative",data:m,borderColor:"rgba(176,42,55,1)",backgroundColor:"rgba(227,93,106,0.25)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Comment Timeline (Early → Recent)",font:{size:12}},ticks:{autoSkip:!1,maxRotation:0,font:{size:11}}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Sentiment Score",font:{size:12}},ticks:{callback:l=>`${l}%`}}},interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom"}}}})},it=function(t){if(!t||!Array.isArray(t))return;const a=[],i=[],n=[];t.forEach(o=>{const c={text:o.text||"",confidence:(typeof o.confidence=="number"?o.confidence>1?o.confidence:o.confidence*100:0).toFixed(1),commentId:o.commentId||o.comment_id||null,author:o.author||"Anonymous"},m=o.predicted_sentiment||o.sentiment;m==="positive"?a.push(c):m==="neutral"?i.push(c):m==="negative"&&n.push(c)}),a.sort((o,c)=>parseFloat(c.confidence)-parseFloat(o.confidence)),i.sort((o,c)=>parseFloat(c.confidence)-parseFloat(o.confidence)),n.sort((o,c)=>parseFloat(c.confidence)-parseFloat(o.confidence)),(()=>{const o=(c,m)=>{const l=document.getElementById(c);l&&(l.textContent=String(m))};o("positiveCount",a.length),o("neutralCount",i.length),o("negativeCount",n.length)})();const r=(o,c,m)=>{const l=document.getElementById(c);if(!l)return;if(o.length===0){l.innerHTML='<p class="text-muted text-center py-3">No samples available</p>';return}const x=Math.min(o.length,50),v=(b,u=300)=>b.length<=u?b:b.substring(0,u)+"...",p=b=>b.replace(/[&<>"']/g,u=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[u]);l.innerHTML=o.slice(0,x).map((b,u)=>{const d=p(v(b.text)),g=parseFloat(b.confidence)>=80?"success":parseFloat(b.confidence)>=60?"warning":"secondary",h=`comment-${m}-${u}`;return`
            <div class="comment-sample-item ${m}" id="${h}" data-comment-index="${u}">
              <div class="comment-sample-text">${d}</div>
              <div class="comment-sample-meta">
                <span class="text-muted"><i class="fas fa-user-circle"></i> ${p((b.author||"Anonymous").substring(0,20))}</span>
                <span class="confidence-badge bg-${g}">${b.confidence}%</span>
              </div>
              <div class="feedback-buttons">
                <span class="text-muted" style="font-size: 0.7rem; margin-right: 8px;">AI thinks:</span>
                <button class="feedback-btn positive ${m==="positive"?"current-sentiment":""}" ${m==="positive"?"disabled":""} onclick="submitFeedback('${h}', '${m}', 'positive', ${u})">👍 Positive</button>
                <button class="feedback-btn neutral ${m==="neutral"?"current-sentiment":""}" ${m==="neutral"?"disabled":""} onclick="submitFeedback('${h}', '${m}', 'neutral', ${u})">👐 Neutral</button>
                <button class="feedback-btn negative ${m==="negative"?"current-sentiment":""}" ${m==="negative"?"disabled":""} onclick="submitFeedback('${h}', '${m}', 'negative', ${u})">👎 Negative</button>
              </div>
            </div>
          `}).join(""),o.length>x&&(l.innerHTML+=`<div class="text-center text-muted py-2"><small><i class="fas fa-info-circle"></i> Showing ${x} of ${o.length} ${m} comments</small></div>`)};Z.positive=a,Z.neutral=i,Z.negative=n,r(a,"positiveSamples","positive"),r(i,"neutralSamples","neutral"),r(n,"negativeSamples","negative"),setTimeout(Ke,100)},ke=function(t,a,i){if(!t)return;if(t.classList.add("manually-corrected"),!t.querySelector(".manual-correction-badge")){const s=document.createElement("div");s.className="manual-correction-badge",s.innerHTML='<i class="fas fa-user-check"></i> Manually Corrected',t.appendChild(s)}if(t.querySelectorAll(".feedback-btn").forEach(s=>{s.disabled=!0,s.classList.remove("current-sentiment","highlighted-correction","disabled-original"),s.classList.contains(a)?s.classList.add("disabled-original"):s.classList.contains(i)&&s.classList.add("highlighted-correction")}),!t.querySelector(".correction-info")){const s=document.createElement("div");s.className="correction-info",s.innerHTML=`
          <i class="fas fa-info-circle"></i>
          <span class="original-prediction">AI predicted: ${Ce(a)}</span>
          <span class="user-correction">→ You corrected to: ${Ce(i)}</span>
        `,t.appendChild(s)}},Ve=function(t,a,i){const n=`sentiment_corrections_${B}`;let s={};try{s=JSON.parse(localStorage.getItem(n)||"{}")}catch{s={}}const r=(t||"").substring(0,100);s[r]={original:a,corrected:i,timestamp:new Date().toISOString()},localStorage.setItem(n,JSON.stringify(s))},Ke=function(){const t=`sentiment_corrections_${B}`;let a={};try{a=JSON.parse(localStorage.getItem(t)||"{}")}catch{a={}}Object.keys(Z).forEach(i=>{(Z[i]||[]).forEach((n,s)=>{const r=(n.text||"").substring(0,100),o=a[r];if(o){const c=`comment-${i}-${s}`,m=document.getElementById(c);m&&ke(m,o.original,o.corrected)}})})},Qe=function(t,a={}){if(!t)return;const i=document.getElementById("react-comment-metrics");if(!i)return;const{elapsedSeconds:n,totalAnalyzed:s,videoViews:r=0,videoLikes:o=0}=a,c=te(i),m=s??t.total_analyzed??0,l=t.analysis_depth_percentage??0,x=t.top_level_count??0,v=n??null,p=v?Math.max(0,m/v).toFixed(1):null,b=r>0?(o/r*100).toFixed(1):"0.0",u=Array.isArray(t.top_commenters)?t.top_commenters:[];function d(){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header header-muted-blue",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-chart-bar"})," Comment Coverage & Stats"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"coverage-summary mb-3",children:[e.jsxs("div",{className:"coverage-main",style:{display:"flex",alignItems:"baseline",gap:"8px"},children:[e.jsx("span",{className:"coverage-number",children:m.toLocaleString()}),e.jsx("span",{className:"coverage-text",children:"comments analyzed"}),e.jsxs("span",{className:"badge badge-info ml-2",children:[l,"% coverage"]})]}),e.jsxs("div",{className:"coverage-details",style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[e.jsxs("span",{className:"detail-item",children:[e.jsx("i",{className:"fas fa-comments"})," ",x.toLocaleString()," threads"]}),v?e.jsxs("span",{className:"detail-item",children:[e.jsx("i",{className:"fas fa-clock"})," ",v,"s"]}):null,p?e.jsxs("span",{className:"detail-item",children:[e.jsx("i",{className:"fas fa-tachometer-alt"})," ",p," /sec"]}):null]})]}),e.jsxs("div",{className:"comment-stats-grid mb-3",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-primary",children:e.jsx("i",{className:"fas fa-users"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:(t.unique_commenters||0).toLocaleString()}),e.jsx("div",{className:"stat-label",children:"Unique Users"})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-success",children:e.jsx("i",{className:"fas fa-text-width"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:t.avg_comment_length||0}),e.jsx("div",{className:"stat-label",children:"Avg Length"})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-info",children:e.jsx("i",{className:"fas fa-comment-dots"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:(t.top_level_count||0).toLocaleString()}),e.jsx("div",{className:"stat-label",children:"Comments"})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-warning",children:e.jsx("i",{className:"fas fa-percentage"})}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("div",{className:"stat-value",children:[b,"%"]}),e.jsx("div",{className:"stat-label",children:"Engagement"})]})]})]}),u.length>0&&e.jsxs("div",{className:"card bg-light",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-trophy"})," Most Active Commenters"]})}),e.jsx("div",{className:"card-body",children:e.jsx("ol",{className:"list-group list-group-flush",children:u.slice(0,10).map((g,h)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:[e.jsxs("strong",{children:["#",h+1]})," ",String(g[0])]}),e.jsxs("span",{className:"badge badge-primary badge-pill",children:[(g[1]||0).toLocaleString()," comments"]})]},h))})})]})]})]})}c.render(e.jsx(d,{}))},$=function(t,a="info",i=3e3){let n=document.getElementById("toastContainer");n||(n=document.createElement("div"),n.id="toastContainer",n.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 9999;",document.body.appendChild(n));const s=document.createElement("div"),r=a==="success"?"success":a==="danger"?"danger":a==="warning"?"warning":"info";s.className=`alert alert-${r} alert-dismissible fade show`,s.style.cssText="min-width: 250px; margin-bottom: 10px; animation: slideIn 0.3s ease-out;",s.setAttribute("role","alert");const o=a==="success"?"✓":a==="danger"?"✕":a==="warning"?"⚠":"ℹ";s.innerHTML=`<strong>${o}</strong> ${t}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>`,n.appendChild(s),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),150)},i)},H=function(t){const a=document.getElementById("analysisProgress"),i=document.getElementById("startSentimentAnalysis");O&&(clearInterval(O),O=null),q&&(clearInterval(q),q=null),V&&(cancelAnimationFrame(V),V=null);let n="Oops! Something went wrong",s=t||"Unknown error",r="fas fa-exclamation-triangle",o=[];const c=String(t||"").toLowerCase();c.includes("unfinished")||c.includes("timeout")?(n="Analysis Timeout",r="fas fa-clock",s="The analysis is taking longer than expected. This usually happens when processing many comments.",o=["Try analyzing fewer comments","Wait a moment for the service to recover","Try again in a few minutes"]):c.includes("memory")||c.includes("cache")?(n="Service Temporarily Busy",r="fas fa-server",s="Our servers are experiencing high demand right now.",o=["Please wait and try again","Consider analyzing fewer comments","Try during off-peak hours"]):c.includes("not found")?(n="Analysis Not Found",r="fas fa-search",s="The analysis results couldn't be found. They may have expired.",o=["Start a fresh analysis","Make sure you haven't waited too long"]):c.includes("network")||c.includes("fetch")?(n="Connection Issue",r="fas fa-wifi",s="There was a problem connecting to our analysis service.",o=["Check your internet","Refresh the page","Disable any blockers that might interfere"]):(c.includes("high load")||c.includes("service"))&&(n="Service Under Load",r="fas fa-chart-line",s="Our sentiment analysis service is experiencing high demand.",o=["Try with fewer comments","Wait a few minutes","Consider queue option if available"]);const m=o.length>0?`<div class="mt-3"><h6 class="font-weight-bold">What you can try:</h6><ul class="mb-0">${o.map(l=>`<li>${l}</li>`).join("")}</ul></div>`:"";a&&(a.innerHTML=`
          <div class="error-container animated fadeIn">
            <div class="alert alert-danger border-0 shadow-sm" style="border-radius:12px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">
              <div class="d-flex align-items-start">
                <div class="error-icon-wrapper mr-3" style="font-size:2rem; color:#dc2626;"><i class="${r}"></i></div>
                <div class="flex-grow-1">
                  <h5 class="alert-heading mb-2" style="color:#991b1b;">${n}</h5>
                  <p class="mb-0" style="color:#7f1d1d;">${s}</p>
                  ${m}
                  <details class="mt-3"><summary style="cursor:pointer; color:#991b1b; font-size:0.85rem;"><i class="fas fa-bug"></i> Technical details</summary><pre class="mt-2 p-2 bg-white rounded" style="font-size:0.75rem; color:#6b7280; max-height:100px; overflow-y:auto;">${t}</pre></details>
                </div>
              </div>
            </div>
            <div class="text-center mt-3">
              <button class="btn btn-lg" onclick="location.reload()" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-radius:25px; padding:12px 30px; border:none; box-shadow:0 4px 15px rgba(102,126,234,0.4);"> <i class="fas fa-redo mr-2"></i> Refresh & Try Again</button>
            </div>
          </div>
        `),i&&(i.innerHTML='<i class="fas fa-brain"></i> Retry Analysis',i.disabled=!1),Y&&clearInterval(Y)},_e=function(){const t=document.getElementById("loginPromptModal");t&&t.remove(),document.body.insertAdjacentHTML("beforeend",`
        <div class="modal fade" id="loginPromptModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius:15px; border:none; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
              <div class="modal-header" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-radius:15px 15px 0 0;">
                <h5 class="modal-title"><i class="fas fa-sign-in-alt mr-2"></i>Sign In Required</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: brightness(0) invert(1); opacity: 0.8;"></button>
              </div>
              <div class="modal-body text-center" style="padding:2rem;">
                <div class="mb-3"><i class="fas fa-lock" style="font-size:3rem; color:#667eea; opacity:0.7;"></i></div>
                <h5 class="mb-3">Want to analyze more comments?</h5>
                <p class="text-muted mb-4">Sign in to queue analysis jobs and analyze up to 2,500 comments!</p>
                <div class="mb-3">
                  <div class="alert alert-info" style="border-radius: 10px;">
                    <strong>Free Account Benefits:</strong><br>
                    <small>✓ Analyze up to 2,500 comments<br>✓ Queue background jobs<br>✓ Save analysis history<br>✓ Export results</small>
                  </div>
                </div>
              </div>
              <div class="modal-footer" style="border-top:none; padding:0 2rem 2rem 2rem;">
                <a href="/login" class="btn btn-primary btn-lg" style="border-radius:25px; width:100%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border:none;"><i class="fas fa-sign-in-alt mr-2"></i>Sign In for Free Analysis</a>
                <div class="text-center mt-2"><small class="text-muted">Don't have an account? <a href="/register" class="text-primary">Create one free</a></small></div>
              </div>
            </div>
          </div>
        </div>`),window.bootstrap&&new window.bootstrap.Modal(document.getElementById("loginPromptModal")).show()},Ge=function(){const t=document.getElementById("proUpgradePromptModal");t&&t.remove(),document.body.insertAdjacentHTML("beforeend",`
        <div class="modal fade" id="proUpgradePromptModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius:15px; border:none; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
              <div class="modal-header" style="background:linear-gradient(135deg,#f59e0b 0%, #d97706 100%); color:white; border-radius:15px 15px 0 0;">
                <h5 class="modal-title"><i class="fas fa-crown mr-2"></i>Upgrade to Pro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: brightness(0) invert(1); opacity: 0.8;"></button>
              </div>
              <div class="modal-body text-center" style="padding:2rem;">
                <div class="mb-3"><i class="fas fa-star" style="font-size:3rem; color:#f59e0b;"></i></div>
                <h5 class="mb-3">Unlock Advanced Analysis</h5>
                <p class="text-muted mb-4">Upgrade to Pro to analyze up to 5,000 comments!</p>
                <div class="mb-3">
                  <div class="alert alert-warning" style="border-radius: 10px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none;">
                    <strong>Pro Account Benefits:</strong><br>
                    <small style="color:#92400e;">✓ Analyze up to 5,000 comments<br>✓ Process entire videos<br>✓ Advanced filtering options<br>✓ Priority processing<br>✓ Detailed analytics reports</small>
                  </div>
                </div>
              </div>
              <div class="modal-footer" style="border-top:none; padding:0 2rem 2rem 2rem;">
                <a href="/subscribe" class="btn btn-warning btn-lg" style="border-radius:25px; width:100%; background:linear-gradient(135deg,#f59e0b 0%, #d97706 100%); border:none; color:white;"><i class="fas fa-crown mr-2"></i>Upgrade to Pro</a>
                <div class="text-center mt-2"><small class="text-muted"><a href="#" class="text-warning" data-bs-dismiss="modal">Maybe later</a></small></div>
              </div>
            </div>
          </div>
        </div>`),window.bootstrap&&new window.bootstrap.Modal(document.getElementById("proUpgradePromptModal")).show()},Ce=function(t){return(t||"").charAt(0).toUpperCase()+(t||"").slice(1)};console.log("[AnalyzeApp] Starting initialization for comment analysis...");const C=document.getElementById("react-analyze-root");if(!C){ve("React analyze root element is missing.");return}const B=C.getAttribute("data-video-id")||"",oe=(C.getAttribute("data-is-auth")||"false")==="true",re=(C.getAttribute("data-is-pro")||"false")==="true",Ze=parseInt(C.getAttribute("data-video-comments")||"0",10)||0,ye=parseInt(C.getAttribute("data-video-views")||"0",10)||0,Ie=parseInt(C.getAttribute("data-video-likes")||"0",10)||0,ot=C.getAttribute("data-video-title")||"",rt=C.getAttribute("data-video-channel")||"",lt=C.getAttribute("data-video-published")||"",ct=C.getAttribute("data-video-duration")||"",dt=C.getAttribute("data-video-url")||"";let A;try{A=JSON.parse(C.getAttribute("data-comment-stats")||"{}")}catch{A={}}let T;try{T=JSON.parse(C.getAttribute("data-precomputed-results")||"null")}catch{T=null}let Ee;try{Ee=JSON.parse(C.getAttribute("data-updated-stats")||"null")}catch{Ee=null}let R=null,Y=null,z={},le="instant",Z={positive:[],neutral:[],negative:[]},ce=null,O=null,se=0,q=null,Xe=0,Te=0,de=0,V=null;window.submitFeedback=tt,window.showLoginPrompt=_e,window.showProUpgradePrompt=Ge,window.startSentimentAnalysis=E,window.handleAnalyzeClick=j,window.isAuthenticated=oe,window.isProUser=re,window.testScroll=function(){document.getElementById("analysisProgress").scrollIntoView()};const et=Number((A==null?void 0:A.top_level_count)||0),Me=Number((A==null?void 0:A.total_top_level_comments)||(A==null?void 0:A.total_available)||0)||et||5e3;window.currentTotalComments=Me;const xe=document.querySelector("#analysis-controls-root");if(console.log("[AnalyzeApp] Comment analysis mount found:",xe),xe){console.log("[AnalyzeApp] Inserting analyze button directly"),xe.innerHTML=`
        <div class="text-center py-3">
          <button id="mainAnalyzeBtn" class="btn btn-lg" 
                  style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                         color: white; 
                         border: none; 
                         border-radius: 25px; 
                         padding: 12px 40px; 
                         font-size: 1.1rem; 
                         font-weight: 600; 
                         box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); 
                         cursor: pointer;
                         transition: all 0.3s ease;">
            <span>🧠</span> Analyze Sentiment
          </button>
        </div>
      `;const t=document.getElementById("mainAnalyzeBtn");t&&(t.onclick=function(a){a.preventDefault();const i=document.getElementById("sentimentAnalysisSection");i&&(i.style.display="block",typeof E=="function"&&(E(),document.getElementById("sentimentAnalysisSection").scrollIntoView()))},t.addEventListener("mouseenter",()=>{t.style.transform="translateY(-2px)",t.style.boxShadow="0 6px 20px rgba(102, 126, 234, 0.5)"}),t.addEventListener("mouseleave",()=>{t.style.transform="translateY(0)",t.style.boxShadow="0 4px 15px rgba(102, 126, 234, 0.4)"}))}const je=document.getElementById("analysisProgress");if(je){let t=function(){const[s,r]=S.useState(0),[o,c]=S.useState("Initializing vibe check..."),[m,l]=S.useState("Warming up the sentiment engines..."),[x,v]=S.useState(""),[p,b]=S.useState("Did you know? The average YouTube comment is 27 words long!");return S.useEffect(()=>{const u=g=>{const h=g.detail||{};typeof h.progress=="number"&&r(Math.max(0,Math.min(100,h.progress))),h.status&&c(h.status),h.subStatus&&l(h.subStatus),typeof h.detail=="string"&&v(h.detail)},d=setInterval(()=>{b(g=>{const h=(ne.indexOf(g)+1+ne.length)%ne.length;return ne[h]||g})},5e3);return window.addEventListener("analysis:progress",u),()=>{window.removeEventListener("analysis:progress",u),clearInterval(d)}},[]),e.jsxs("div",{className:"analysis-loading-content",children:[e.jsx("div",{className:"vibe-spinner mb-4",children:e.jsxs("div",{className:"vibe-spinner-inner",children:[e.jsx("span",{className:"vibe-emoji",children:"🎭"}),e.jsx("span",{className:"vibe-emoji",children:"😊"}),e.jsx("span",{className:"vibe-emoji",children:"😐"}),e.jsx("span",{className:"vibe-emoji",children:"😔"})]})}),e.jsx("h4",{className:"loading-status",id:"progressStatus",children:o}),e.jsx("p",{className:"loading-substatus",id:"progressSubStatus",children:m}),e.jsxs("div",{className:"vibe-progress-container",children:[e.jsx("div",{className:"vibe-progress-bar",children:e.jsx("div",{className:"vibe-progress-fill",style:{width:`${Math.round(s)}%`},children:e.jsx("div",{className:"vibe-progress-glow"})})}),e.jsx("div",{className:"vibe-progress-text",style:{textAlign:"center"},children:e.jsxs("span",{id:"progressText",style:{fontSize:"1.2rem",fontWeight:600,color:"#667eea"},children:[Math.round(s),"%"]})})]}),e.jsxs("div",{className:"loading-fun-fact",id:"loadingFunFact",children:[e.jsx("i",{className:"fas fa-lightbulb"}),e.jsx("span",{id:"funFactText",children:p})]})]})};je.innerHTML="";const a=document.createElement("div");je.appendChild(a);const i=te(a);let n=0;n===0&&(document.getElementById("analysisProgress").scrollIntoView(),n=1),i.render(e.jsx(t,{}))}const Ne=document.getElementById("analysisResults");if(Ne){let t=function(){var U,N,L,Q,me,Fe;const[n,s]=S.useState(null),[r,o]=S.useState(!1),c=Oe.useRef(null),m=Oe.useRef(null);if(S.useEffect(()=>{const I=_=>{s(_.detail||null)};return window.addEventListener("analysis:results",I),()=>window.removeEventListener("analysis:results",I)},[]),S.useEffect(()=>{var Pe;if(!n||!window.Chart)return;const I=n.sentiment||{},_=c.current;if(_){const F=_.getContext("2d"),w=I.sentiment_counts||I.distribution||{positive:0,neutral:0,negative:0},W=w.positive+w.neutral+w.negative,D=W>0?{positive:(w.positive/W*100).toFixed(1),neutral:(w.neutral/W*100).toFixed(1),negative:(w.negative/W*100).toFixed(1)}:{positive:0,neutral:0,negative:0};z.bar&&z.bar.destroy(),z.bar=new window.Chart(F,{type:"bar",data:{labels:["Sentiment Distribution"],datasets:[{label:`Positive (${D.positive}%)`,data:[w.positive||0],backgroundColor:"rgba(34,197,94,0.9)",borderColor:"rgba(34,197,94,1)",borderWidth:1,barPercentage:1,categoryPercentage:1},{label:`Neutral (${D.neutral}%)`,data:[w.neutral||0],backgroundColor:"rgba(156,163,175,0.9)",borderColor:"rgba(156,163,175,1)",borderWidth:1,barPercentage:1,categoryPercentage:1},{label:`Negative (${D.negative}%)`,data:[w.negative||0],backgroundColor:"rgba(239,68,68,0.9)",borderColor:"rgba(239,68,68,1)",borderWidth:1,barPercentage:1,categoryPercentage:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,display:!1,grid:{display:!1}},y:{stacked:!0,display:!1,grid:{display:!1}}},plugins:{legend:{display:!0,position:"bottom",labels:{boxWidth:15,padding:10,font:{size:12}}},tooltip:{callbacks:{label:function(ae){const ge=ae.dataset.label||"",he=ae.parsed.x||0;return`${ge}: ${he} comments`}}}}}})}const ue=m.current;if(ue){z.timeline&&z.timeline.destroy();let F=n.timeline;if((!F||F.length===0)&&((Pe=I.individual_results)==null?void 0:Pe.length)>0&&(F=I.individual_results.map((w,W)=>({sentiment:w.predicted_sentiment||w.sentiment||"neutral",score:w.sentiment_scores||{positive:w.predicted_sentiment==="positive"?.8:.1,neutral:w.predicted_sentiment==="neutral"?.8:.1,negative:w.predicted_sentiment==="negative"?.8:.1},text_preview:(w.text||"").substring(0,100),index:W}))),F&&F.length>0){const w=[],W=Math.max(1,Math.ceil(F.length/20));for(let P=0;P<F.length;P+=W){const pe=F.slice(P,Math.min(P+W,F.length));let G=0,Be=0,Re=0,ee=0;pe.forEach(fe=>{const De=fe.score||fe.sentiment_scores||{},He=fe.sentiment||fe.predicted_sentiment||"neutral",Se=Object.keys(De).length?De:He==="positive"?{positive:.8,neutral:.15,negative:.05}:He==="negative"?{positive:.05,neutral:.15,negative:.8}:{positive:.1,neutral:.8,negative:.1};G+=Se.positive||0,Be+=Se.neutral||0,Re+=Se.negative||0,ee++}),ee=Math.max(ee,1),w.push({positive:G/ee*100,neutral:Be/ee*100,negative:Re/ee*100,index:P})}const D=[],ae=[],ge=[],he=[];w.forEach((P,pe)=>{const G=P.index/F.length*100;pe===0?D.push("Early"):pe===w.length-1?D.push("Recent"):Math.abs(G-25)<5?D.push("25%"):Math.abs(G-50)<5?D.push("Midpoint"):Math.abs(G-75)<5?D.push("75%"):D.push(`${Math.round(G)}%`),ae.push(P.positive),ge.push(P.neutral),he.push(P.negative)});const st=ue.getContext("2d");z.timeline=new window.Chart(st,{type:"line",data:{labels:D,datasets:[{label:"Positive",data:ae,borderColor:"rgba(25,135,84,1)",backgroundColor:"rgba(209,231,221,0.35)",tension:.4},{label:"Neutral",data:ge,borderColor:"rgba(160,165,170,1)",backgroundColor:"rgba(206,212,218,0.35)",tension:.4},{label:"Negative",data:he,borderColor:"rgba(176,42,55,1)",backgroundColor:"rgba(227,93,106,0.25)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Comment Timeline (Early → Recent)",font:{size:12}},ticks:{autoSkip:!1,maxRotation:0,font:{size:11}}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Sentiment Score",font:{size:12}},ticks:{callback:P=>`${P}%`}}},plugins:{legend:{position:"bottom"}}}})}}},[n]),!n)return null;const l=n.sentiment||{},x=l.total_analyzed||((U=l.individual_results)==null?void 0:U.length)||0,v=((N=l.distribution)==null?void 0:N.positive)||0,p=((L=l.distribution)==null?void 0:L.negative)||0,b=((Q=l.distribution)==null?void 0:Q.neutral)||0,u=v+p+b;let d="neutral";u>0&&(v>p&&v>b?d="positive":p>v&&p>b&&(d="negative"));const g=(typeof l.average_confidence=="number"?l.average_confidence>1?l.average_confidence:l.average_confidence*100:0).toFixed(1),h=n.updated_stats||null,f=ye>0?(Ie/ye*100).toFixed(1):"0.0",y=l.sentiment_counts||l.distribution||{positive:0,neutral:0,negative:0},k=y.positive+y.neutral+y.negative,K=k>0?{positive:(y.positive/k*100).toFixed(1),neutral:(y.neutral/k*100).toFixed(1),negative:(y.negative/k*100).toFixed(1)}:{positive:0,neutral:0,negative:0};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"alert alert-info",children:[e.jsxs("h4",{className:"alert-heading",children:[e.jsx("i",{className:"fas fa-chart-line"})," Overall Sentiment"]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:((me=d[0])==null?void 0:me.toUpperCase())+d.slice(1)})," — analyzed ",x," comments (confidence ",g,"%)"]})]})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header header-muted-blue",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-chart-bar"})," Sentiment Distribution"]})}),e.jsxs("div",{className:"card-body",style:{paddingTop:"20px",paddingBottom:"10px"},children:[e.jsx("div",{style:{height:"80px",marginBottom:"10px"},children:e.jsx("canvas",{ref:c})}),e.jsxs("div",{className:"sentiment-stats-row",style:{display:"flex",justifyContent:"space-around",marginTop:"15px",paddingTop:"15px",borderTop:"1px solid #e9ecef"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#22c55e"},children:["😊 ",K.positive,"%"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:[y.positive.toLocaleString()," positive"]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#9ca3af"},children:["😐 ",K.neutral,"%"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:[y.neutral.toLocaleString()," neutral"]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#ef4444"},children:["😔 ",K.negative,"%"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#6b7280"},children:[y.negative.toLocaleString()," negative"]})]})]})]})]})})}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header header-muted-blue",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-robot"})," AI Analysis Summary"]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"lead",style:{fontSize:"16px",lineHeight:"1.6"},children:(Fe=n.summary)!=null&&Fe.summary?e.jsx("div",{children:n.summary.summary.split(`
`).map((I,_)=>e.jsx("p",{children:I},_))}):e.jsx("div",{children:r?e.jsxs("p",{className:"text-info",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Regenerating summary..."]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-muted",children:"Summary not available yet. The AI is processing the analysis results."}),e.jsxs("button",{className:"btn btn-sm btn-outline-primary mt-2",disabled:r,onClick:()=>{const I=window.currentAnalysisId||R;I&&(o(!0),fetch(`/api/analyze/retry-summary/${I}`,{method:"POST"}).then(_=>_.json()).then(_=>{_.success&&_.summary&&s(ue=>({...ue,summary:_.summary})),o(!1)}).catch(_=>{console.error("Failed to retry summary:",_),o(!1)}))},children:[e.jsx("i",{className:"fas fa-redo"})," Generate Summary"]})]})})})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header header-muted-blue",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-clock"})," Sentiment Timeline"]})}),e.jsx("div",{className:"card-body",children:e.jsx("canvas",{ref:m,width:"400",height:"200"})})]}),h&&e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header header-muted-blue",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-chart-bar"})," Comment Coverage & Stats"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"coverage-summary mb-3",children:[e.jsxs("div",{className:"coverage-main",style:{display:"flex",alignItems:"baseline",gap:"8px"},children:[e.jsx("span",{className:"coverage-number",children:(h.total_analyzed||x).toLocaleString()}),e.jsx("span",{className:"coverage-text",children:"comments analyzed"}),"analysis_depth_percentage"in h&&e.jsxs("span",{className:"badge badge-info ml-2",children:[h.analysis_depth_percentage,"% coverage"]})]}),e.jsx("div",{className:"coverage-details",style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:"top_level_count"in h&&e.jsxs("span",{className:"detail-item",children:[e.jsx("i",{className:"fas fa-comments"})," ",(h.top_level_count||0).toLocaleString()," threads"]})})]}),e.jsxs("div",{className:"comment-stats-grid mb-3",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-primary",children:e.jsx("i",{className:"fas fa-users"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:(h.unique_commenters||0).toLocaleString()}),e.jsx("div",{className:"stat-label",children:"Unique Users"})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-success",children:e.jsx("i",{className:"fas fa-text-width"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:h.avg_comment_length||0}),e.jsx("div",{className:"stat-label",children:"Avg Length"})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-info",children:e.jsx("i",{className:"fas fa-comment-dots"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:(h.top_level_count||0).toLocaleString()}),e.jsx("div",{className:"stat-label",children:"Comments"})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon text-warning",children:e.jsx("i",{className:"fas fa-percentage"})}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("div",{className:"stat-value",children:[f,"%"]}),e.jsx("div",{className:"stat-label",children:"Engagement"})]})]})]}),Array.isArray(h.top_commenters)&&h.top_commenters.length>0&&e.jsxs("div",{className:"card bg-light",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-trophy"})," Most Active Commenters"]})}),e.jsx("div",{className:"card-body",children:e.jsx("ol",{className:"list-group list-group-flush",children:h.top_commenters.slice(0,10).map((I,_)=>e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:[e.jsxs("strong",{children:["#",_+1]})," ",String(I[0])]}),e.jsxs("span",{className:"badge badge-primary badge-pill",children:[(I[1]||0).toLocaleString()," comments"]})]},_))})})]})]})]})]})};Ne.innerHTML="";const a=document.createElement("div");Ne.appendChild(a),te(a).render(e.jsx(t,{}))}const we=document.getElementById("sampleCommentsSection");if(we){let t=function(){const[n,s]=S.useState({positive:[],neutral:[],negative:[]}),[r,o]=S.useState({}),[c,m]=S.useState({});S.useEffect(()=>{$e().then(v=>{const p={};Object.keys(v).forEach(b=>{p[b]=v[b]}),m(p)})},[]),S.useEffect(()=>{const v=p=>{const b=Array.isArray(p.detail)?p.detail:[],u=[],d=[],g=[];b.forEach(f=>{const y=f.predicted_sentiment||f.sentiment,k={text:f.text||"",confidence:typeof f.confidence=="number"?f.confidence>1?f.confidence:f.confidence*100:0,commentId:f.commentId||f.comment_id||null,author:f.author||"Anonymous",originalSentiment:y};y==="positive"?u.push(k):y==="negative"?g.push(k):d.push(k)}),u.sort((f,y)=>y.confidence-f.confidence),d.sort((f,y)=>y.confidence-f.confidence),g.sort((f,y)=>y.confidence-f.confidence),s({positive:u,neutral:d,negative:g});const h=`sentiment_corrections_${B}`;try{const f=JSON.parse(localStorage.getItem(h)||"{}");o(f)}catch{}};return window.addEventListener("analysis:samples",v),()=>window.removeEventListener("analysis:samples",v)},[]);function l({items:v,tone:p}){const[b,u]=S.useState({}),[d,g]=S.useState({});async function h(f,y){const k=v[f];if(!k||y===p)return;const K=(k.text||"").substring(0,100);try{g(L=>({...L,[f]:!0}));const N=await(await fetch("/api/sentiment-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_id:B,comment_id:k.commentId,comment_text:k.text,comment_author:k.author,predicted_sentiment:p,corrected_sentiment:y,confidence_score:(k.confidence||0)/100})})).json();if(N.success){$(N.message||"Thank you for your feedback!","success",3e3),u(me=>({...me,[f]:{original:p,corrected:y}}));const L=`sentiment_corrections_${B}`;let Q={};try{Q=JSON.parse(localStorage.getItem(L)||"{}")}catch{}Q[K]={original:p,corrected:y,timestamp:new Date().toISOString()},localStorage.setItem(L,JSON.stringify(Q)),o(Q)}else N.error&&N.error.includes("already submitted")?($("You've already provided feedback for this comment","info"),u(L=>({...L,[f]:{original:p,corrected:y}}))):$(N.error||"Failed to submit feedback","warning")}catch{$("Failed to submit feedback","danger")}finally{g(U=>({...U,[f]:!1}))}}return e.jsxs("div",{className:"comment-samples-container",children:[v.length===0?e.jsx("p",{className:"text-muted text-center py-3",children:"No samples available"}):v.slice(0,50).map((f,y)=>{const k=f.confidence>=80?"success":f.confidence>=60?"warning":"secondary",K=(f.text||"").length<=300?f.text:(f.text||"").substring(0,300)+"...",U=(f.text||"").substring(0,100),N=b[y]||r[U]||c[U],L=d[y];return e.jsxs("div",{className:`comment-sample-item ${p} ${N?"manually-corrected":""}`,children:[e.jsx("div",{className:"comment-sample-text",children:K}),e.jsxs("div",{className:"comment-sample-meta",children:[e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-user-circle"})," ",(f.author||"Anonymous").substring(0,20)]}),e.jsxs("span",{className:`confidence-badge bg-${k}`,children:[f.confidence.toFixed(1),"%"]})]}),N&&e.jsxs("div",{className:"correction-info",style:{padding:"8px",background:"#f0f9ff",borderRadius:"4px",marginTop:"8px",marginBottom:"8px",fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-user-check",style:{color:"#3b82f6",marginRight:"6px"}}),e.jsxs("span",{style:{color:"#64748b"},children:["AI predicted: ",e.jsx("strong",{children:N.original})]}),e.jsx("span",{style:{color:"#3b82f6",marginLeft:"8px",marginRight:"8px"},children:"→"}),e.jsxs("span",{style:{color:"#16a34a"},children:["You corrected to: ",e.jsx("strong",{children:N.corrected})]})]}),e.jsxs("div",{className:"feedback-buttons",children:[e.jsxs("span",{className:"text-muted",style:{fontSize:"0.7rem",marginRight:8},children:["AI thinks: ",e.jsx("strong",{children:p})]}),e.jsx("button",{className:`vibe-button small ${p==="positive"?"current-sentiment":""} ${(N==null?void 0:N.corrected)==="positive"?"highlighted-correction":""}`,disabled:p==="positive"||L||!!N,onClick:()=>h(y,"positive"),children:"👍 Positive"}),e.jsx("button",{className:`vibe-button small ${p==="neutral"?"current-sentiment":""} ${(N==null?void 0:N.corrected)==="neutral"?"highlighted-correction":""}`,disabled:p==="neutral"||L||!!N,onClick:()=>h(y,"neutral"),children:"👐 Neutral"}),e.jsx("button",{className:`vibe-button small ${p==="negative"?"current-sentiment":""} ${(N==null?void 0:N.corrected)==="negative"?"highlighted-correction":""}`,disabled:p==="negative"||L||!!N,onClick:()=>h(y,"negative"),children:"👎 Negative"})]})]},y)}),v.length>50&&e.jsx("div",{className:"text-center text-muted py-2",children:e.jsxs("small",{children:[e.jsx("i",{className:"fas fa-info-circle"})," Showing 50 of ",v.length," ",p," comments"]})})]})}const x=n.positive.length+n.neutral.length+n.negative.length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header-vibe d-flex justify-content-between align-items-center",style:{marginBottom:"20px"},children:[e.jsxs("h3",{className:"mb-0",children:[e.jsx("span",{className:"emoji-icon",children:"💬"})," Sample Comments by Sentiment"]}),e.jsxs("span",{className:"badge",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontSize:"0.9rem",padding:"6px 12px"},children:[x," total"]})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"sentiment-section mb-4",children:[e.jsx("div",{className:"sentiment-positive sentiment-header-section",children:e.jsxs("h5",{children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-smile"})," Positive"]}),e.jsx("span",{className:"badge",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:n.positive.length})]})}),e.jsx(l,{items:n.positive,tone:"positive"})]}),e.jsxs("div",{className:"sentiment-section mb-4",children:[e.jsx("div",{className:"sentiment-neutral sentiment-header-section",children:e.jsxs("h5",{children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-meh"})," Neutral"]}),e.jsx("span",{className:"badge",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:n.neutral.length})]})}),e.jsx(l,{items:n.neutral,tone:"neutral"})]}),e.jsxs("div",{className:"sentiment-section mb-4",children:[e.jsx("div",{className:"sentiment-negative sentiment-header-section",children:e.jsxs("h5",{children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-frown"})," Negative"]}),e.jsx("span",{className:"badge",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:n.negative.length})]})}),e.jsx(l,{items:n.negative,tone:"negative"})]}),e.jsxs("div",{className:"feedback-notice mt-3",children:[e.jsx("i",{className:"fas fa-robot"})," Your feedback helps us improve our AI models. Click the sentiment buttons to correct any misclassifications."]})]})]})};const a=document.createElement("div");we.innerHTML="",we.appendChild(a),te(a).render(e.jsx(t,{}))}if(T){const t=document.getElementById("sentimentAnalysisSection"),a=document.getElementById("analysisProgress"),i=document.getElementById("analysisResults");t&&(t.style.display="block",t.classList.add("active")),a&&(a.style.display="none"),i&&(i.style.display="block");const n={sentiment:{overall_sentiment:T.overall_sentiment||"neutral",distribution:T.distribution||{positive:0,neutral:0,negative:0},distribution_percentage:T.percentages||{positive:0,neutral:0,negative:0},sentiment_counts:T.distribution||{positive:0,neutral:0,negative:0},sentiment_percentages:T.percentages||{positive:0,neutral:0,negative:0},average_confidence:T.average_confidence||0,sentiment_score:T.sentiment_score||0,total_analyzed:T.total_analyzed||0,individual_results:T.individual_results||[],model:T.model||"enhanced-sentiment-v1"},summary:{summary:T.summary||"Analysis completed successfully."}};Ae(n);const s=document.getElementById("sampleCommentsSection");s&&(s.style.display="block"),window.dispatchEvent(new CustomEvent("analysis:results",{detail:n})),n&&n.sentiment&&Array.isArray(n.sentiment.individual_results)&&window.dispatchEvent(new CustomEvent("analysis:samples",{detail:n.sentiment.individual_results}))}(async()=>await $e())();const ze=document.getElementById("startSentimentAnalysis");ze&&ze.addEventListener("click",E);const Le=document.getElementById("analysis-controls-root");if(Le){let t=function(){const i=window.currentTotalComments||Me,n=Math.min(500,i),s=Math.min(re?5e3:2500,i),[r,o]=S.useState("instant"),[c,m]=S.useState(Math.min(100,n)),[l,x]=S.useState(Math.min(1e3,s)),v=Math.min(100,Math.round(c/(i||1)*100)),p=Math.min(100,Math.round(l/(i||1)*100));function b(){le="instant",M("instant",c),document.getElementById("analysisProgress").scrollIntoView()}function u(){if(le="queue",!oe){$("Please sign in to queue analysis","warning"),_e();return}const d=document.getElementById("queueAnalyzeBtnReact");d&&(d.disabled=!0,d.innerHTML='<i class="fas fa-spinner fa-spin"></i> Queueing...'),fetch("/api/analyze/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_id:B,comment_count:l,include_replies:!1})}).then(g=>g.json()).then(g=>{if(g.success){const h=Math.max(1,Math.round(l/100*1.5/60));$(`Analysis queued! Estimated time: ~${h} min`,"success"),setTimeout(()=>{window.location.href="/profile"},1200)}else $(g.error||"Failed to queue analysis","danger"),d&&(d.disabled=!1,d.innerHTML='<i class="fas fa-clock"></i> Queue Analysis')}).catch(g=>{console.error("Queue error:",g),$("Failed to queue analysis","danger"),d&&(d.disabled=!1,d.innerHTML='<i class="fas fa-clock"></i> Queue Analysis')})}return e.jsxs("div",{className:"coverage-card",children:[e.jsx("div",{className:"coverage-header",children:e.jsxs("h5",{className:"coverage-title",children:[e.jsx("span",{className:"coverage-icon",children:"📊"})," Analysis Coverage"]})}),e.jsxs("div",{className:"coverage-body",children:[e.jsxs("ul",{className:"nav nav-tabs analysis-tabs",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${r==="instant"?"active":""}`,type:"button",onClick:()=>o("instant"),children:[e.jsx("i",{className:"fas fa-bolt"})," Instant"]})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${r==="queue"?"active":""}`,type:"button",onClick:()=>o("queue"),children:[e.jsx("i",{className:"fas fa-clock"})," Queue"]})})]}),r==="instant"?e.jsxs("div",{className:"analysis-form mt-4",children:[e.jsx("h6",{className:"text-muted mb-3",children:"Instant Analysis"}),e.jsxs("div",{className:"slider-container mb-3",children:[e.jsxs("label",{className:"slider-label",children:["Comments: ",e.jsx("span",{children:c})]}),e.jsx("input",{className:"form-range coverage-slider",type:"range",min:1,max:n,step:1,value:c,onChange:d=>m(parseInt(d.target.value||"0",10))}),e.jsxs("div",{className:"slider-limits",children:[e.jsx("small",{children:"1"}),e.jsx("small",{children:n})]})]}),e.jsxs("div",{className:"analysis-stats mb-3",children:[e.jsxs("span",{className:"stat-item",children:[e.jsx("i",{className:"fas fa-percentage"})," Coverage: ",e.jsxs("strong",{children:[v,"%"]})]}),e.jsxs("span",{className:"stat-item",children:[e.jsx("i",{className:"fas fa-clock"})," Time: ",e.jsx("strong",{children:c<=100?"~5s":c<=300?"~15s":"~30s"})]})]}),e.jsxs("button",{className:"vibe-button",onClick:b,children:[e.jsx("span",{className:"button-icon",children:"⚡"}),e.jsx("span",{className:"button-text",children:"Analyze"})]})]}):e.jsxs("div",{className:"analysis-form mt-4",children:[e.jsx("h6",{className:"text-muted mb-3",children:"Queue Analysis"}),oe?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"slider-container mb-3",children:[e.jsxs("label",{className:"slider-label",children:["Comments: ",e.jsx("span",{children:l.toLocaleString()})]}),e.jsx("input",{className:"form-range coverage-slider",type:"range",min:1,max:s,step:s<100?1:10,value:l,onChange:d=>x(parseInt(d.target.value||"1",10))}),e.jsxs("div",{className:"slider-limits",children:[e.jsx("small",{children:"1"}),e.jsx("small",{children:s<1e3?s:`${(s/1e3).toFixed(1).replace(".0","")}k`})]})]}),e.jsxs("div",{className:"analysis-stats mb-3",children:[e.jsxs("span",{className:"stat-item",children:[e.jsx("i",{className:"fas fa-percentage"})," Coverage: ",e.jsxs("strong",{children:[p,"%"]})]}),e.jsxs("span",{className:"stat-item",children:[e.jsx("i",{className:"fas fa-clock"})," Time: ",e.jsx("strong",{children:Math.round(l*.12)<60?`~${Math.round(l*.12)}s`:`~${Math.round(l*.12/60)} min`})]})]}),e.jsxs("button",{id:"queueAnalyzeBtnReact",className:"vibe-button",onClick:u,children:[e.jsx("span",{className:"button-icon",children:"⏱"}),e.jsx("span",{className:"button-text",children:"Queue Analysis"})]}),!re&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-crown"})," Upgrade to Pro for up to 5,000 comments (currently 2,500 limit) ",e.jsx("br",{}),e.jsx("a",{href:"/subscribe",children:"Learn More"})]})})]}):e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"fas fa-lock"})," Sign in to queue analysis",e.jsxs("div",{className:"mt-3",children:[e.jsx("a",{href:"/login",className:"btn btn-sm btn-primary",children:"Sign In"}),e.jsx("a",{href:"/register",className:"btn btn-sm btn-outline-primary",children:"Create Account"})]})]})]})]})]})};te(Le).render(e.jsx(t,{}))}async function tt(t,a,i,n){if(a===i)return;const s=document.getElementById(t),r=(Z[a]||[])[n];if(r)try{const o=(s==null?void 0:s.querySelectorAll(".feedback-btn"))||[];o.forEach(l=>l.disabled=!0);const m=await(await fetch("/api/sentiment-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({video_id:B,comment_id:r.commentId,comment_text:r.text,comment_author:r.author,predicted_sentiment:a,corrected_sentiment:i,confidence_score:parseFloat(r.confidence)/100})})).json();m.success?($(m.message||"Thank you for your feedback!","success",3e3),ke(s,a,i),Ve(r.text,a,i)):(o.forEach(l=>l.disabled=!1),m.error&&m.error.includes("already submitted")?$("You've already provided feedback for this comment","info"):$(m.error||"Failed to submit feedback","warning"))}catch(o){console.error("Error submitting feedback:",o),$("Failed to submit feedback. Please try again.","danger"),((s==null?void 0:s.querySelectorAll(".feedback-btn"))||[]).forEach(m=>m.disabled=!1)}}async function $e(){try{const a=await(await fetch(`/api/sentiment-feedback?video_id=${B}`)).json();if(a.success&&a.feedback.length>0){const i=`sentiment_corrections_${B}`,n={};return a.feedback.forEach(s=>{const r=(s.comment_text||"").substring(0,100);n[r]={original:s.predicted_sentiment,corrected:s.corrected_sentiment,timestamp:s.created_at}}),localStorage.setItem(i,JSON.stringify(n)),n}}catch(t){console.error("Error loading user feedback:",t)}return{}}const X={fetching_comments:["Reticulating comment splines...","Downloading hot takes from the cloud...","Harvesting fresh opinions...","Summoning the comment spirits...","Deploying YouTube API ninjas...","Gathering digital discourse...","Extracting text vibes from the matrix..."],analyzing_sentiment:["Calibrating emotional sensors...","Teaching AI about human feelings...","Decoding sentiment wavelengths...","Consulting the vibe oracle...","Computing emotional algorithms...","Analyzing the mood spectrum...","Processing digital emotions...","Calculating happiness quotients...","Measuring sentiment particles..."],generating_summary:["Crafting wisdom from chaos...","Distilling comment essence...","Generating insight crystals...","Compiling the final verdict...","Preparing your custom report...","Assembling thought molecules...","Weaving the narrative tapestry..."]},ne=["Did you know? The average YouTube comment is 27 words long!","Fun fact: 70% of YouTube comments are positive or neutral!","YouTube gets over 500 hours of video uploaded every minute!","The first YouTube comment ever was 'Interesting...' in 2005!","Comments with emojis get 33% more engagement! 😊","YouTube comments support over 75 languages worldwide!","The most liked YouTube comment has over 4 million likes!","Did you know? Comments peak within the first 2 hours of upload!","YouTube's algorithm considers comment sentiment for recommendations!"];return()=>{window.submitFeedback=void 0,window.showLoginPrompt=void 0,window.showProUpgradePrompt=void 0,window.startSentimentAnalysis=void 0,Y&&clearInterval(Y),O&&clearInterval(O),q&&clearInterval(q),V&&cancelAnimationFrame(V),Object.values(z).forEach(t=>{try{t.destroy()}catch{}})}}catch(j){ve("Failed to initialize the Analyze UI.",j)}},[]),null}function at(j="react-analyze-root"){const M=document.getElementById(j);if(!M)return;te(M).render(e.jsx(nt,{}))}if(typeof window<"u"){const j=()=>{document.getElementById("react-analyze-root")&&at("react-analyze-root")};document.readyState==="loading"?window.addEventListener("DOMContentLoaded",j):j()}
