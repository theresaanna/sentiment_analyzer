{% extends "base.html" %}

{% block title %}Analysis Results - VibeCheckAI{% endblock %}

{% block extra_css %}
<style>
    .sentiment-card {
        transition: transform 0.2s;
    }
    .sentiment-card:hover {
        transform: translateY(-5px);
    }
    .progress-container {
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .analysis-section {
        display: none;
    }
    .analysis-section.active {
        display: block;
    }
    .sentiment-positive { color: #28a745; }
    .sentiment-negative { color: #dc3545; }
    .sentiment-neutral { color: #6c757d; }
    
    /* Vibe Card styling */
    .vibe-card {
        background: white;
        border-radius: 25px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        overflow: hidden;
    }
    
    .card-header-vibe {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.25rem 1.5rem;
        border-bottom: none;
        font-weight: 600;
    }
    
    .card-header-vibe h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
    }
    
    .emoji-icon {
        margin-right: 0.5rem;
    }
    
    /* Analyze button hover effect */
    .analyze-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5) !important;
    }
    
    /* Pulse animation for analyze button */
    .pulse-animation {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
        }
        70% {
            transform: scale(1.05);
            box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
        }
        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
        }
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Updated stats highlighting */
    .updated-badge {
        animation: fadeIn 0.5s ease-in-out;
    }
    
    .stats-value.updated {
        animation: pulse 1s ease-in-out;
        color: #10b981 !important;
        transition: color 0.3s ease;
    }
    
    /* Free analysis button styling */
    .vibe-button.free-analysis {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-size: 1.1rem;
        padding: 14px 28px;
    }
    
    .free-analysis-info {
        background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
        border: 2px solid #e0e7ff;
        border-radius: 12px;
        padding: 12px 20px;
        margin-top: 15px;
        font-size: 0.95rem;
    }
    
    .free-analysis-info strong {
        color: #5a67d8;
        font-size: 1rem;
    }
    
    .free-analysis-info small {
        display: block;
        margin-top: 5px;
        color: #6b7280;
    }
    
    /* Word cloud controls */
    .word-cloud-controls {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .zoom-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    
    .zoom-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
    }
    
    /* Enhanced summary styling */
    #aiSummary {
        font-size: 16px;
        line-height: 1.6;
    }
    
    #aiSummary .alert, #aiSummary .card {
        font-size: 15px;
    }
    
    #aiSummary .theme-content .badge {
        font-size: 13px;
        padding: 5px 10px;
        margin-right: 5px;
    }
    
    #aiSummary .blockquote-sm {
        font-size: 14px;
        border-left: 3px solid #dee2e6;
        padding-left: 10px;
    }
    
    #aiSummary .controversy-content {
        font-size: 14px;
    }
    
    #aiSummary ul li {
        margin-bottom: 8px;
    }
    
    .alert-heading {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .card-title {
        font-size: 16px;
        font-weight: 600;
    }
    
    /* Compact stats card styling */
    .stats-card {
        padding: 0.75rem;
    }
    
    .stats-card .stats-value {
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1;
        margin-bottom: 0.25rem;
        white-space: nowrap;
    }
    
    .stats-card .stats-label {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 0;
        white-space: nowrap;
    }
    
    .stats-card .stats-icon {
        font-size: 0.75rem;
        margin-right: 0.25rem;
    }
    
    /* New compact video metadata styles */
    .video-metadata {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 12px;
        font-size: 0.85rem;
    }
    
    .metadata-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        padding: 4px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .metadata-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .metadata-item i {
        width: 18px;
        font-size: 0.75rem;
        margin-right: 8px;
    }
    
    .metadata-label {
        font-weight: 600;
        color: #6c757d;
        margin-right: auto;
        min-width: 60px;
    }
    
    .metadata-value {
        color: #495057;
        text-align: right;
        flex: 1;
    }
    
    .metadata-value a {
        color: #007bff;
        text-decoration: none;
    }
    
    .metadata-value a:hover {
        text-decoration: underline;
    }
    
    /* Compact stats grid */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .stat-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 12px;
        display: flex;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .stat-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    /* Enhanced Loading Experience Styles */
    .analysis-loading-content {
        text-align: center;
        padding: 2rem;
    }
    
    /* Custom Vibe Spinner */
    .vibe-spinner {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto;
    }
    
    .vibe-spinner-inner {
        position: relative;
        width: 100%;
        height: 100%;
        animation: vibeRotate 8s linear infinite;
    }
    
    .vibe-emoji {
        position: absolute;
        font-size: 2rem;
        animation: emojiPulse 2s ease-in-out infinite;
    }
    
    .vibe-emoji:nth-child(1) {
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        animation-delay: 0s;
    }
    
    .vibe-emoji:nth-child(2) {
        top: 50%;
        right: 0;
        transform: translateY(-50%);
        animation-delay: 0.5s;
    }
    
    .vibe-emoji:nth-child(3) {
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        animation-delay: 1s;
    }
    
    .vibe-emoji:nth-child(4) {
        top: 50%;
        left: 0;
        transform: translateY(-50%);
        animation-delay: 1.5s;
    }
    
    @keyframes vibeRotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    @keyframes emojiPulse {
        0%, 100% { 
            transform: scale(1) translateX(var(--tx, -50%)) translateY(var(--ty, 0));
            opacity: 0.7;
        }
        50% { 
            transform: scale(1.2) translateX(var(--tx, -50%)) translateY(var(--ty, 0));
            opacity: 1;
        }
    }
    
    /* Loading Status Text */
    .loading-status {
        color: #667eea;
        font-weight: 600;
        margin-bottom: 0.5rem;
        animation: fadeInOut 3s ease-in-out infinite;
    }
    
    .loading-substatus {
        color: #718096;
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
        font-style: italic;
        animation: fadeInOut 4s ease-in-out infinite;
    }
    
    @keyframes fadeInOut {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }
    
    /* Stylized Progress Bar */
    .vibe-progress-container {
        max-width: 400px;
        margin: 0 auto 2rem;
    }
    
    .vibe-progress-bar {
        height: 28px;
        background: #e2e8f0;
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.08);
    }
    
    .vibe-progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        border-radius: 20px;
        transition: width 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
        position: relative;
        width: 0%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .vibe-progress-glow {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 100px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        animation: progressGlow 2s linear infinite;
    }
    
    @keyframes progressGlow {
        0% { transform: translateX(-100px); }
        100% { transform: translateX(100px); }
    }
    
    .vibe-progress-text {
        margin-top: 0.75rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .vibe-progress-text #progressText {
        font-weight: 600;
        color: #667eea;
        font-size: 1.2rem;
    }
    
    /* Fun Facts Section */
    .loading-fun-fact {
        background: linear-gradient(135deg, #faf5ff 0%, #f3e7fc 100%);
        border: 1px solid #e9d5ff;
        border-radius: 12px;
        padding: 12px 20px;
        margin-top: 2rem;
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideUp 0.5s ease-out;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .loading-fun-fact i {
        color: #f59e0b;
        font-size: 1.2rem;
        animation: bulbBlink 2s ease-in-out infinite;
    }
    
    @keyframes bulbBlink {
        0%, 100% { opacity: 0.5; }
        50% { opacity: 1; }
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    #funFactText {
        flex: 1;
        color: #6b46c1;
        font-size: 0.9rem;
        transition: opacity 0.3s ease-in-out;
    }
    
    /* Error Container Animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .error-container.animated {
        animation: fadeIn 0.5s ease-out;
    }
    
    .error-container details summary:hover {
        text-decoration: underline;
    }
    
    /* Simplified Tab Styles */
    .analysis-tabs {
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 0;
    }
    
    .analysis-tabs .nav-link {
        border: none;
        border-radius: 0;
        padding: 12px 24px;
        color: #6c757d;
        font-weight: 600;
        background: transparent;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .analysis-tabs .nav-link:hover {
        color: #495057;
        background: #f8f9fa;
    }
    
    .analysis-tabs .nav-link.active {
        color: #667eea;
        background: transparent;
        border: none;
    }
    
    .analysis-tabs .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }
    
    .analysis-form {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .slider-container {
        margin-bottom: 20px;
    }
    
    .slider-label {
        display: block;
        font-weight: 600;
        margin-bottom: 10px;
        color: #2d3748;
    }
    
    .analysis-slider {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #e2e8f0;
        outline: none;
        -webkit-appearance: none;
    }
    
    .analysis-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
    }
    
    .analysis-slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
    }
    
    .slider-limits {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        color: #6c757d;
        font-size: 0.85rem;
    }
    
    .analysis-stats {
        display: flex;
        justify-content: space-around;
        gap: 20px;
        padding: 15px;
        background: white;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .analysis-stats .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        color: #4a5568;
    }
    
    .analysis-stats .stat-item i {
        color: #667eea;
        font-size: 1rem;
    }
    
    .analysis-stats .stat-item strong {
        color: #2d3748;
        font-size: 1.1rem;
    }
    
    .slider-range-indicators {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding: 0 10px;
        gap: 10px;
    }
    
    .range-indicator {
        flex: 1;
        padding: 8px 12px;
        background: #f7fafc;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .range-indicator:hover {
        background: #edf2f7;
        transform: translateY(-2px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .range-indicator.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .range-indicator.queue-active {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: white;
        border-color: #f59e0b;
    }
    
    .range-indicator.pro-active {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-color: #059669;
    }
    
    .range-indicator .range-label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 2px;
    }
    
    .range-indicator .range-limit {
        display: block;
        font-size: 0.75rem;
        opacity: 0.8;
    }
    
    .range-indicator.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: #f1f5f9;
    }
    
    .range-indicator.disabled:hover {
        transform: none;
        background: #f1f5f9;
        box-shadow: none;
    }
    
    .slider-container {
        margin-top: 0;
    }
    
    .coverage-slider {
        transition: background 0.3s ease;
    }
    
    .coverage-slider.queue-mode {
        background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
    }
    
    .coverage-slider.pro-mode {
        background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    }
    
    #analysisActionButton {
        transition: all 0.3s ease;
    }
    
    #analysisActionButton.queue-mode {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    }
    
    #analysisActionButton.pro-mode {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .stat-icon {
        font-size: 1.2rem;
        margin-right: 10px;
        opacity: 0.8;
    }
    
    .stat-content {
        flex: 1;
    }
    
    .stat-value {
        font-size: 1.1rem;
        font-weight: 700;
        line-height: 1;
        margin-bottom: 2px;
        color: #2d3748;
        display: block;
    }
    
    .stat-label {
        font-size: 0.7rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* Comment Analysis Section Styles */
    .comment-coverage-info {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 16px;
        border: 1px solid #e9ecef;
    }
    
    .coverage-summary {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .coverage-main {
        display: flex;
        align-items: baseline;
        gap: 8px;
        font-size: 1.1rem;
    }
    
    .coverage-number {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2d3748;
    }
    
    .coverage-text {
        color: #6c757d;
        font-size: 1rem;
    }
    
    .coverage-details {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    .detail-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .detail-item i {
        font-size: 0.75rem;
        opacity: 0.7;
    }
    
    /* Comment stats grid - same style as video stats */
    .comment-stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
    }
    
    /* Pro upgrade banner */
    .pro-upgrade-banner {
        background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        border: 1px solid #667eea30;
        border-radius: 8px;
        padding: 12px;
    }
    
    .pro-banner-content {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .pro-star {
        font-size: 1.5rem;
        color: #667eea;
    }
    
    .pro-text {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    
    .pro-text strong {
        color: #2d3748;
        font-size: 0.95rem;
    }
    
    .pro-text span {
        color: #6c757d;
        font-size: 0.85rem;
    }
    
    .pro-upgrade-banner .btn {
        white-space: nowrap;
    }
    
    /* New coverage UI styles */
    .option-card {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        transition: all 0.3s;
    }
    
    .option-card:hover {
        border-color: #667eea;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }
    
    .option-card h6 {
        color: #2d3748;
        margin-bottom: 8px;
        font-size: 1rem;
    }
    
    .option-card p {
        color: #6c757d;
        margin-bottom: 12px;
    }
    
    .pro-features-teaser {
        background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
        border: 1px solid #e0e7ff;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }
    
    .coverage-free-user, .coverage-logged-in {
        padding: 20px;
    }
    
    .analysis-options {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    /* Editable comment count input styles */
    .stat-value-input {
        background: transparent;
        border: 1px solid transparent;
        border-radius: 4px;
        color: #2d3748;
        font-size: 1.1rem;
        font-weight: 700;
        text-align: center;
        max-width: 140px;
        padding: 2px 4px;
        transition: all 0.2s;
    }
    
    .stat-value-input:hover {
        background: #f8f9fa;
        border-color: #e9ecef;
    }
    
    .stat-value-input:focus {
        background: white;
        border-color: #667eea;
        outline: none;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
    }
    
    .stat-value-input::-webkit-inner-spin-button,
    .stat-value-input::-webkit-outer-spin-button {
        opacity: 0;
        transition: opacity 0.2s;
    }
    
    .stat-value-input:hover::-webkit-inner-spin-button,
    .stat-value-input:hover::-webkit-outer-spin-button,
    .stat-value-input:focus::-webkit-inner-spin-button,
    .stat-value-input:focus::-webkit-outer-spin-button {
        opacity: 1;
    }
    
    /* Responsive adjustments */
    @media (max-width: 991px) {
        /* Stack video and metadata on tablets and below */
        .video-metadata {
            margin-top: 20px;
        }
        
        .stats-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    
    @media (max-width: 768px) {
        .stats-card .stats-value {
            font-size: 1.25rem;
        }
        .stats-card .stats-label {
            font-size: 0.8rem;
        }
        
        /* Make stats grid 2x2 on mobile */
        .stats-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        /* Comment stats grid responsive - 2x2 on mobile */
        .comment-stats-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        .stat-value {
            font-size: 0.95rem;
        }
        
        .stat-label {
            font-size: 0.65rem;
        }
    }
    
    @media (max-width: 480px) {
        /* Even more compact on very small screens */
        .metadata-item {
            font-size: 0.8rem;
        }
        
        .metadata-label {
            min-width: 50px;
        }
        
        .stat-item {
            padding: 8px;
        }
        
        .stat-icon {
            font-size: 1rem;
        }
    }
    
    /* Toast animation */
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    /* Manually corrected comment styles */
    .comment-sample-item.manually-corrected {
        background: linear-gradient(135deg, #f0f4f8 0%, #e8ecf0 100%);
        border: 2px solid #94a3b8;
        position: relative;
    }
    
    .manual-correction-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #3b82f6;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .correction-info {
        background: #f8fafc;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        padding: 8px 12px;
        margin-top: 10px;
        font-size: 0.85rem;
    }
    
    .correction-info .original-prediction {
        text-decoration: line-through;
        opacity: 0.6;
        color: #64748b;
    }
    
    .correction-info .user-correction {
        color: #059669;
        font-weight: 600;
        margin-left: 8px;
    }
    
    .feedback-btn.disabled-original {
        opacity: 0.4;
        text-decoration: line-through;
        cursor: not-allowed;
        background: #e2e8f0;
    }
    
    .feedback-btn.highlighted-correction {
        background: #10b981;
        color: white;
        font-weight: 600;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }
    
    @media (max-width: 576px) {
        .stats-card {
            padding: 0.5rem;
        }
        .stats-card .stats-value {
            font-size: 1.1rem;
        }
    }
    
    /* Word cloud responsive styling */
    #wordCloudContainer {
        overflow-x: auto;
        overflow-y: hidden;
    }
    
    #wordCloud {
        display: block;
        margin: 0 auto;
        background: linear-gradient(135deg, #f5f7fa 0%, #f8f9ff 100%);
    }
    
    /* Key Discussion Themes enhanced styling */
    .theme-grid {
        margin-top: 1rem;
    }
    
    .theme-item {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border: 1px solid #e3e6f0;
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .theme-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        border-color: #c3c9e0;
    }
    
    .theme-item .badge {
        font-size: 16px;
        padding: 8px 14px;
        margin-right: 12px;
        font-weight: 700;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .theme-item strong {
        font-size: 22px;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    /* Color differentiation for high vs moderate relevance */
    .theme-item-high strong {
        color: #6f42c1;
        background: linear-gradient(90deg, #6f42c1, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .theme-item-moderate strong {
        color: #4c6ef5;
        background: linear-gradient(90deg, #4c6ef5, #5a67d8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .badge-danger {
        background: linear-gradient(135deg, #8b5cf6 0%, #6f42c1 100%);
        border: none;
    }
    
    .badge-warning {
        background: linear-gradient(135deg, #5a67d8 0%, #4c6ef5 100%);
        border: none;
    }
    
    /* Mobile responsive for themes */
    @media (max-width: 768px) {
        .theme-item strong {
            font-size: 20px;
        }
        .theme-item .badge {
            font-size: 14px;
            padding: 6px 10px;
        }
        .theme-item {
            padding: 10px 14px;
        }
    }
    
    @media (max-width: 576px) {
        .theme-item strong {
            font-size: 18px;
        }
        .theme-item .badge {
            font-size: 13px;
            padding: 5px 8px;
        }
    }
    
    /* Scrollable comment samples - updated for vertical stacking */
    .comment-samples-container {
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 15px;
        scrollbar-width: thin;
        scrollbar-color: #cbd5e0 #f7fafc;
        background: linear-gradient(to bottom, #f8f9fa 0%, #f0f2f5 100%);
        border-radius: 0 0 8px 8px;
        border: 1px solid #e9ecef;
        border-top: none;
        margin-bottom: 0;
    }
    
    /* Sentiment section styling for vertical layout */
    .sentiment-section {
        width: 100%;
    }
    
    /* Ensure full width for sentiment headers */
    .sentiment-header-section {
        width: 100%;
        margin-bottom: 0;
    }
    
    /* Sample comments body padding */
    #sampleCommentsSection .card-body {
        padding: 1.5rem;
    }
    
    /* Make sample comments section wider on larger screens */
    /* Responsive padding adjustments */
    @media (min-width: 1200px) {
        #sampleCommentsSection .card-body {
            padding: 2rem;
        }
    }
    
    @media (min-width: 1400px) {
        #sampleCommentsSection .card-body {
            padding: 2.5rem;
        }
    }
    
    /* Separate visual styling for the sample comments section - now using vibe-card */
    #sampleCommentsSection {
        margin-top: 2rem;
    }
    
    /* Sample Comments header uses default vibe-card styling */
    
    .comment-samples-container::-webkit-scrollbar {
        width: 8px;
    }
    
    .comment-samples-container::-webkit-scrollbar-track {
        background: #f7fafc;
        border-radius: 4px;
    }
    
    .comment-samples-container::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 4px;
    }
    
    .comment-samples-container::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
    }
    
    .comment-sample-item {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 14px;
        margin-bottom: 14px;
        transition: all 0.2s ease;
    }
    
    .comment-sample-item:hover {
        background: white;
        border-color: #dee2e6;
        transform: translateX(2px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .comment-sample-text {
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 10px;
        word-wrap: break-word;
        color: #2d3748;
    }
    
    .comment-sample-meta {
        font-size: 0.8rem;
        color: #6c757d;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .confidence-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.75rem;
    }
    
    .comment-sample-item.positive {
        border-left: 3px solid #28a745;
    }
    
    .comment-sample-item.negative {
        border-left: 3px solid #dc3545;
    }
    
    .comment-sample-item.neutral {
        border-left: 3px solid #6c757d;
    }
    
    /* Sentiment headers styling */
    .sentiment-header-section {
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border-radius: 8px 8px 0 0;
        padding: 12px 16px;
        margin-bottom: 0;
        border: 1px solid #d1d5db;
        border-bottom: 2px solid #9ca3af;
    }
    
    .sentiment-header-section h5 {
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 1.2rem;
    }
    
    .sentiment-positive.sentiment-header-section {
        background: linear-gradient(135deg, #d4edda 0%, #f4f9f5 100%);
        border-color: #c3e6cb;
    }
    
    .sentiment-neutral.sentiment-header-section {
        background: linear-gradient(135deg, #e2e3e5 0%, #f8f9fa 100%);
        border-color: #d6d8db;
    }
    
    .sentiment-negative.sentiment-header-section {
        background: linear-gradient(135deg, #f8d7da 0%, #fff5f5 100%);
        border-color: #f5c6cb;
    }
    
    /* Feedback buttons styling */
    .feedback-buttons {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
    }
    
    .feedback-btn {
        background: none;
        border: 1px solid #dee2e6;
        border-radius: 16px;
        padding: 4px 10px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        color: #6c757d;
    }
    
    .feedback-btn:hover:not(.current-sentiment) {
        background: #f8f9fa;
        border-color: #adb5bd;
        transform: scale(1.05);
    }
    
    .feedback-btn.current-sentiment {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        cursor: default;
        font-weight: 600;
    }
    
    .feedback-btn.positive:hover:not(.current-sentiment) {
        border-color: #28a745;
        color: #28a745;
    }
    
    .feedback-btn.neutral:hover:not(.current-sentiment) {
        border-color: #6c757d;
        color: #495057;
    }
    
    .feedback-btn.negative:hover:not(.current-sentiment) {
        border-color: #dc3545;
        color: #dc3545;
    }
    
    .feedback-notice {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 12px;
        margin-top: 12px;
        font-size: 0.85rem;
        color: #6c757d;
        text-align: center;
    }
    
    .feedback-notice i {
        color: #667eea;
        margin-right: 4px;
    }
    
    @keyframes fadeOutUp {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-20px);
        }
    }
    
    .comment-sample-item.removing {
        animation: fadeOutUp 0.5s ease-out;
    }
    
    /* Sentiment correction styles */
    .comment-sample-item.manually-corrected {
        background: linear-gradient(135deg, #fef3c7 0%, #fef9e5 100%);
        border-color: #f59e0b;
        position: relative;
    }
    
    .manually-corrected::before {
        content: '‚úì';
        position: absolute;
        top: 8px;
        right: 8px;
        background: #10b981;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
    }
    
    .correction-info {
        background: #f0f9ff;
        border-radius: 6px;
        padding: 10px;
        margin-top: 10px;
        margin-bottom: 10px;
        font-size: 0.85rem;
        border: 1px solid #bfdbfe;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .vibe-button.highlighted-correction {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
        border-color: #10b981 !important;
        color: white !important;
        font-weight: 600;
        position: relative;
        padding-right: 28px;
    }
    
    .vibe-button.highlighted-correction::after {
        content: '‚úì';
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
    }
    
    .vibe-button.small:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .vibe-button.small.current-sentiment {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }
</style>
{% endblock %}

{% block content %}
<div class="analyze-page">
    <div class="container">
        <!-- React mount and server context for JS -->
        <div id="react-analyze-root"
             data-video-id="{{ video_id }}"
             data-comment-stats='{{ comment_stats|tojson }}'
             data-precomputed-results='{{ precomputed_results|tojson if precomputed_results is defined else "null" }}'
             data-updated-stats='{{ updated_stats|tojson if updated_stats is defined else "null" }}'
             data-video-comments="{{ (video_info.statistics.comments if video_info else 0)|default(0) }}"
             data-video-views="{{ (video_info.statistics.views if video_info else 0)|default(0) }}"
             data-video-likes="{{ (video_info.statistics.likes if video_info else 0)|default(0) }}"
             data-video-title="{{ (video_info.title if video_info else '')|e }}"
             data-video-channel="{{ (video_info.channel if video_info else '')|e }}"
             data-video-published="{{ (video_info.published_at[:10] if video_info else '')|e }}"
             data-video-duration="{{ (video_info.duration | format_duration if video_info else '')|e }}"
             data-video-url="{{ (video_url if video_url else '')|e }}"
             data-is-auth="{{ 'true' if current_user.is_authenticated else 'false' }}"
             data-is-pro="{{ 'true' if current_user.is_authenticated and current_user.is_subscribed else 'false' }}">
        </div>

        <!-- Debug: success = {{ success }} -->
        {% if success %}
        
        <!-- Video Info Card - Server rendered -->
        {% if video_info %}
        <div class="vibe-card mb-4">
            <div class="card-header-vibe">
                <h3 class="mb-0">
                    <span class="emoji-icon">üì∫</span> {{ video_info.title | default('Video', true) }}
                </h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-xl-8 col-lg-7 col-md-12">
                        {% if video_id %}
                        <div style="position: relative; width: 100%; padding-bottom: 56.25%; background: #000; border-radius: 12px; overflow: hidden;">
                            <iframe
                                src="https://www.youtube.com/embed/{{ video_id }}"
                                title="{{ video_info.title | default('YouTube video', true) }}"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen
                                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;">
                            </iframe>
                        </div>
                        {% else %}
                        <div class="alert alert-warning">
                            Unable to render the video player because the video ID is missing.
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-xl-4 col-lg-5 col-md-12">
                        <div class="video-metadata mb-3">
                            <div class="metadata-item">
                                <i class="fas fa-tv text-muted"></i>
                                <span class="metadata-label">Channel</span>
                                <span class="metadata-value">{{ video_info.channel | default('Unknown', true) }}</span>
                            </div>
                            <div class="metadata-item">
                                <i class="fas fa-calendar text-muted"></i>
                                <span class="metadata-label">Published</span>
                                <span class="metadata-value">{{ video_info.published_at[:10] if video_info.published_at else 'Unknown' }}</span>
                            </div>
                            <div class="metadata-item">
                                <i class="fas fa-clock text-muted"></i>
                                <span class="metadata-label">Duration</span>
                                <span class="metadata-value">{{ video_info.duration | format_duration if video_info.duration else 'Unknown' }}</span>
                            </div>
                            <div class="metadata-item">
                                <i class="fas fa-link text-muted"></i>
                                <span class="metadata-label">URL</span>
                                <span class="metadata-value">
                                    <a href="{{ video_url | default('https://www.youtube.com/watch?v=' + video_id, true) }}" target="_blank" rel="noopener">
                                        Watch <i class="fas fa-external-link-alt" style="font-size: 0.7rem;"></i>
                                    </a>
                                </span>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon"><i class="fas fa-eye"></i></div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ '{:,}'.format(video_info.statistics.views | default(0) | int) }}</div>
                                    <div class="stat-label">Views</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon text-success"><i class="fas fa-thumbs-up"></i></div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ '{:,}'.format(video_info.statistics.likes | default(0) | int) }}</div>
                                    <div class="stat-label">Likes</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon text-info"><i class="fas fa-comment"></i></div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ '{:,}'.format(video_info.statistics.comments | default(0) | int) }}</div>
                                    <div class="stat-label">Comments</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Comment Analysis -->
        <div class="vibe-card mb-4">
            <div class="card-header-vibe">
                <h3 class="mb-0">
                    <span class="emoji-icon">üí¨</span> Comment Analysis
                </h3>
            </div>
            <div class="card-body">
                <!-- React Controls Mount -->
                <div id="analysis-controls-root"></div>
            </div>
        </div>
        
        <!-- Sentiment Analysis Section -->
        <div id="sentimentAnalysisSection" class="vibe-card mb-4 analysis-section" style="display: none;">
            <div class="card-header-vibe d-flex justify-content-between align-items-center">
                <h3 class="mb-0">
                    <span class="emoji-icon">üß†</span> Sentiment Analysis
                </h3>
                <button id="startSentimentAnalysis" class="vibe-button small">
                    <span class="button-icon">üß†</span>
                    <span class="button-text">Analyze Sentiment</span>
                </button>
            </div>
            <div class="card-body">
                <!-- Progress Section -->
                <div id="analysisProgress" class="progress-container">
                    <div class="analysis-loading-content">
                        <!-- Custom animated vibes spinner -->
                        <div class="vibe-spinner mb-4">
                            <div class="vibe-spinner-inner">
                                <span class="vibe-emoji">üé≠</span>
                                <span class="vibe-emoji">üòä</span>
                                <span class="vibe-emoji">üòê</span>
                                <span class="vibe-emoji">üòî</span>
                            </div>
                        </div>
                        
                        <h4 id="progressStatus" class="loading-status">Initializing vibe check...</h4>
                        <p id="progressSubStatus" class="loading-substatus">Warming up the sentiment engines...</p>
                        
                        <!-- Styled progress bar -->
                        <div class="vibe-progress-container">
                            <div class="vibe-progress-bar">
                                <div id="progressBar" class="vibe-progress-fill">
                                    <div class="vibe-progress-glow"></div>
                                </div>
                            </div>
                            <div class="vibe-progress-text">
                                <span id="progressText">0%</span>
                                <span id="progressDetail" class="progress-detail"></span>
                            </div>
                        </div>
                        
                        <!-- Fun facts during loading -->
                        <div id="loadingFunFact" class="loading-fun-fact">
                            <i class="fas fa-lightbulb"></i>
                            <span id="funFactText">Did you know? The average YouTube comment is 27 words long!</span>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section (hidden initially) -->
                <div id="analysisResults" style="display: none;">
                    <!-- Overall Sentiment -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="alert alert-info">
                                <h4 class="alert-heading"><i class="fas fa-chart-line"></i> Overall Sentiment</h4>
                                <p id="overallSentiment" class="mb-0"></p>
                            </div>
                        </div>
                    </div>

                    <!-- React metrics mount -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div id="react-comment-metrics"></div>
                        </div>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
<div class="card-header header-muted-blue">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Sentiment Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="sentimentPieChart" width="400" height="400"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Summary -->
                    <div class="card mb-4">
<div class="card-header header-muted-blue">
                            <h5 class="mb-0"><i class="fas fa-robot"></i> AI Analysis Summary</h5>
                        </div>
                        <div class="card-body">
                            <div id="aiSummary" class="lead"></div>
                        </div>
                    </div>
                    
                    <!-- Sentiment Timeline -->
                    <div class="card mb-4">
                        <div class="card-header header-muted-blue">
                            <h5 class="mb-0"><i class="fas fa-clock"></i> Sentiment Timeline</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="sentimentTimelineChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sample Comments Section (Standalone, Wider) -->
        <div id="sampleCommentsSection" class="vibe-card mb-4 analysis-section" style="display: none;">
            <div class="card-header-vibe">
                <h3 class="mb-0">
                    <span class="emoji-icon">üí¨</span> Sample Comments by Sentiment
                </h3>
            </div>
            <div class="card-body">
                <!-- Positive Comments Section -->
                <div class="sentiment-section mb-4">
                    <div class="sentiment-positive sentiment-header-section">
                        <h5>
                            <span><i class="fas fa-smile"></i> Positive</span>
                            <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" id="positiveCount">0</span>
                        </h5>
                    </div>
                    <div id="positiveSamples" class="comment-samples-container"></div>
                </div>
                
                <!-- Neutral Comments Section -->
                <div class="sentiment-section mb-4">
                    <div class="sentiment-neutral sentiment-header-section">
                        <h5>
                            <span><i class="fas fa-meh"></i> Neutral</span>
                            <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" id="neutralCount">0</span>
                        </h5>
                    </div>
                    <div id="neutralSamples" class="comment-samples-container"></div>
                </div>
                
                <!-- Negative Comments Section -->
                <div class="sentiment-section mb-4">
                    <div class="sentiment-negative sentiment-header-section">
                        <h5>
                            <span><i class="fas fa-frown"></i> Negative</span>
                            <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" id="negativeCount">0</span>
                        </h5>
                    </div>
                    <div id="negativeSamples" class="comment-samples-container"></div>
                </div>
                <!-- Feedback Notice -->
                <div class="feedback-notice mt-3">
                    <i class="fas fa-robot"></i>
                    Your feedback helps us improve our AI models. Click the sentiment buttons to correct any misclassifications.
                </div>
            </div>
        </div>
        
        {% else %}
        <!-- Error State -->
        <div class="card shadow">
            <div class="card-header bg-danger text-white">
                <h3 class="mb-0">
                    <i class="fas fa-exclamation-triangle"></i> Analysis Error
                </h3>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <h5 class="alert-heading">Unable to analyze video</h5>
                    <p>{{ error }}</p>
                </div>
            </div>
        </div>
        {% endif %}
        
        <div class="text-center mt-4">
            <a href="{{ url_for('main.index') }}" class="vibe-button">
                <span class="button-icon">‚¨Ö</span> Analyze Another Video
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js for visualization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- WordCloud2.js for word cloud visualization -->
<script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
<!-- React bundle for analyze page -->
<script type="module" src="{{ url_for('static', filename='react/vibe-analyze.js') }}"></script>
{% endblock %}
